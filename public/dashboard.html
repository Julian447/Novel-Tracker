<!DOCTYPE html>
<html>
<head>
  <title>Syosetu Tracker Dashboard</title>
</head>
<body>

  <div id="dashboardContent" style="display:none;">
    <h1>Dashboard</h1>
    <button id="logoutBtn">Logout</button>
    <button onclick="window.location.href='/login'">Go to Login</button>
    <h2>Users</h2>
    <ul id="userList"></ul>
  </div>

  <script src="/auth.js"></script>
  <script>
    requireAuth('dashboardContent');
    function loadUsers() {
      fetch('/api/users', {
        headers: {
          'Authorization': 'Bearer ' + localStorage.getItem('token')
        }
      })
      .then(res => {
        if (res.status === 401 || res.status === 403) {
          document.getElementById('userList').innerHTML = '<li>Login to see users</li>';
          return [];
        }
        return res.json();
      })
      .then(users => {
        const list = document.getElementById('userList');
        list.innerHTML = '';
        users.forEach(u => {
          const li = document.createElement('li');
          li.textContent = `${u.name} (${u.email})`;
          list.appendChild(li);
        });
      });
    }
    loadUsers();

    document.getElementById('logoutBtn').onclick = function() {
      localStorage.removeItem('token');
      alert('Logged out!');
      window.location.href = '/login';
    };
  </script>
</body>
</html>
